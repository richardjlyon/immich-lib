---
phase: 06-synthetic-integration-tests
plan: 02-01
type: execute
---

<objective>
Run the test candidate finder against live Immich, review coverage, and refine the test matrix.

Purpose: Validate which test scenarios have real examples and identify gaps before building synthetic test images.
Output: COVERAGE.md documenting scenario coverage, gaps, and priorities for synthetic image generation.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
~/.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/06-synthetic-integration-tests/06-01-SUMMARY.md

**Prior context:**
- 06-01 built `find-test-candidates` CLI command with 35 scenario detection
- TestScenario enum covers W1-W8, C1-C8, F1-F7, X1-X11
- Report shows coverage statistics and examples

**Files to reference:**
@src/testing/scenarios.rs
@src/bin/immich-dupes.rs
</context>

<tasks>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Test candidate finder from 06-01</what-built>
  <how-to-verify>
    1. Build the project: `cargo build --release`
    2. Run against your Immich instance:
       ```
       ./target/release/immich-dupes find-test-candidates
       ```
    3. Also save JSON output for analysis:
       ```
       ./target/release/immich-dupes find-test-candidates --format json > test-candidates.json
       ```
    4. Review the console output showing:
       - Which scenarios are COVERED (have real examples)
       - Which scenarios are NOT COVERED (need synthetic images)
       - Any UNEXPECTED PATTERNS discovered
    5. Share the summary output (scenario counts, not asset IDs)
  </how-to-verify>
  <resume-signal>Paste the coverage summary output, or describe any issues encountered</resume-signal>
</task>

<task type="auto">
  <name>Task 2: Document scenario coverage matrix</name>
  <files>.planning/phases/06-synthetic-integration-tests/COVERAGE.md</files>
  <action>
Based on the user's reported findings, create COVERAGE.md with:

```markdown
# Test Scenario Coverage

## Summary
- Total scenarios: 35
- Covered by real data: X
- Need synthetic images: Y

## Coverage by Category

### Winner Selection (W1-W8)
| Scenario | Count | Status | Notes |
|----------|-------|--------|-------|
| W1_ClearDimensionWinner | N | ✓/✗ | |
...

### Consolidation (C1-C8)
...

### Conflicts (F1-F7)
...

### Edge Cases (X1-X11)
...

## Unexpected Patterns
[List any patterns the detector surfaced]

## Synthetic Image Requirements
[Prioritized list of scenarios needing synthetic images]

## Test Matrix Refinements
[Any changes to scenario definitions based on findings]
```

Capture exact counts from user output. Mark scenarios as:
- ✓ Covered (have real examples)
- ✗ Gap (need synthetic images)
- ⚠ Partial (few examples, may want synthetic too)
  </action>
  <verify>File exists and contains coverage data</verify>
  <done>COVERAGE.md created with scenario matrix</done>
</task>

<task type="auto">
  <name>Task 3: Prioritize synthetic image generation</name>
  <files>.planning/phases/06-synthetic-integration-tests/COVERAGE.md</files>
  <action>
Add prioritization section to COVERAGE.md:

```markdown
## Synthetic Image Priorities

### P1 - Must Have (core functionality)
[Scenarios that test critical paths with no real examples]

### P2 - Should Have (important edge cases)
[Scenarios with few examples or important coverage gaps]

### P3 - Nice to Have (rare edge cases)
[Scenarios that are unlikely in practice]

### Skip (covered by real data)
[Scenarios with sufficient real examples - no synthetic needed]
```

Priority criteria:
- P1: Winner selection or consolidation scenarios without coverage
- P2: Conflict scenarios or common edge cases
- P3: Rare formats (RAW, HEIC if user doesn't have them)
- Skip: Any scenario with 5+ real examples
  </action>
  <verify>COVERAGE.md has prioritization section</verify>
  <done>Priorities documented for 06-03 image generation</done>
</task>

</tasks>

<verification>
- [ ] User successfully ran find-test-candidates
- [ ] COVERAGE.md exists with scenario matrix
- [ ] Each of 35 scenarios has coverage status
- [ ] Synthetic image priorities are clear for 06-03
</verification>

<success_criteria>
- Coverage data captured from live Immich scan
- Clear identification of which scenarios need synthetic images
- Prioritized list ready for 06-03 (Test Image Generator)
- Any test matrix refinements documented
</success_criteria>

<output>
After completion, create `.planning/phases/06-synthetic-integration-tests/06-02-01-SUMMARY.md`
</output>
