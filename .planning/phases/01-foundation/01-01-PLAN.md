---
phase: 01-foundation
plan: 01
type: execute
---

<objective>
Set up Rust project structure with library crate, binary crate, error types, and API model definitions.

Purpose: Establish the foundational code structure that the HTTP client will build upon.
Output: Working Rust workspace with typed error handling and serde models matching Immich API.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-foundation/01-RESEARCH.md

**From RESEARCH.md - Standard Stack:**
- reqwest 0.12.x with json feature
- tokio 1.x with full features
- serde 1.0.x with derive feature
- serde_json 1.0.x
- thiserror 2.0.x
- url 2.x
- clap 4.x with derive feature (binary)
- anyhow 1.x (binary)

**From RESEARCH.md - Project Structure:**
```
immich-lib/
├── src/
│   ├── lib.rs           # Library crate root
│   ├── client.rs        # ImmichClient (Plan 02)
│   ├── error.rs         # Custom error types
│   ├── models/          # API response types
│   │   ├── mod.rs
│   │   ├── asset.rs     # AssetResponseDto
│   │   ├── duplicate.rs # DuplicateResponseDto
│   │   └── exif.rs      # ExifResponseDto
│   └── bin/
│       └── immich-dupes.rs  # CLI binary
├── Cargo.toml
```

**From RESEARCH.md - API Models:**
- Use `#[serde(rename_all = "camelCase")]` for API compatibility
- ExifInfo fields are mostly Option<T> (nullable in API)
- AssetType enum: IMAGE | VIDEO
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Rust workspace with library and binary</name>
  <files>Cargo.toml, src/lib.rs, src/bin/immich-dupes.rs</files>
  <action>
Create Cargo.toml with:
- Package name: immich-lib
- Edition 2021
- Dependencies from standard stack (reqwest with json, tokio with full, serde with derive, serde_json, thiserror, url)
- Binary target: immich-dupes with clap, anyhow, and dotenvy dependencies

Create src/lib.rs as library root with placeholder module declarations.

Create src/bin/immich-dupes.rs with minimal main function that prints version.

Use Rust 2021 edition. Do NOT add any optional features beyond what's needed.
  </action>
  <verify>cargo build compiles without errors</verify>
  <done>Workspace builds, binary runs and prints version</done>
</task>

<task type="auto">
  <name>Task 2: Define error types with thiserror</name>
  <files>src/error.rs, src/lib.rs</files>
  <action>
Create src/error.rs with ImmichError enum using thiserror derive:
- Http(#[from] reqwest::Error) - HTTP request failures
- Api { status: u16, message: String } - API error responses
- Url(#[from] url::ParseError) - Invalid URL
- InvalidApiKey - Malformed API key
- AssetNotFound(String) - Asset ID not found

Add `pub type Result<T> = std::result::Result<T, ImmichError>;` convenience type.

Update src/lib.rs to:
- Declare `mod error;`
- Re-export `pub use error::{ImmichError, Result};`

Follow thiserror patterns from RESEARCH.md. Each variant should have meaningful #[error("...")] message.
  </action>
  <verify>cargo build compiles, cargo doc generates documentation for error types</verify>
  <done>ImmichError enum exists with all variants, re-exported from lib.rs</done>
</task>

<task type="auto">
  <name>Task 3: Define API response models with serde</name>
  <files>src/models/mod.rs, src/models/asset.rs, src/models/duplicate.rs, src/models/exif.rs, src/lib.rs</files>
  <action>
Create src/models/ directory with four files:

**src/models/exif.rs:**
- ExifInfo struct with all fields from RESEARCH.md ExifResponseDto
- All fields Option<T> except where API guarantees presence
- Use #[serde(rename_all = "camelCase")]
- Fields: latitude, longitude, city, state, country, timeZone, dateTimeOriginal, make, model, lensModel, exposureTime, fNumber, focalLength, iso, exifImageWidth, exifImageHeight, fileSizeInByte, description, rating

**src/models/asset.rs:**
- AssetType enum: Image, Video with serde rename to "IMAGE"/"VIDEO"
- AssetResponse struct matching RESEARCH.md AssetResponseDto
- Fields: id, originalFileName, fileCreatedAt, localDateTime, assetType (renamed from "type"), exifInfo (Option), checksum, isTrashed, isFavorite, isArchived
- Use #[serde(rename_all = "camelCase")]

**src/models/duplicate.rs:**
- DuplicateGroup struct with duplicateId (String) and assets (Vec<AssetResponse>)
- Use #[serde(rename_all = "camelCase")]

**src/models/mod.rs:**
- Declare and re-export all models

**src/lib.rs:**
- Add `pub mod models;`

All structs should derive Debug, Deserialize. Asset types also derive Clone for later use.
  </action>
  <verify>cargo build compiles, cargo test (even with no tests) passes</verify>
  <done>All model structs exist, compile, and match Immich API structure</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `cargo build` succeeds without errors or warnings
- [ ] `cargo run --bin immich-dupes` executes and shows version
- [ ] `cargo doc --no-deps` generates documentation
- [ ] All public types are re-exported from lib.rs
</verification>

<success_criteria>
- All tasks completed
- All verification checks pass
- No compiler warnings (use `#![warn(missing_docs)]` is optional for now)
- Project structure matches RESEARCH.md recommendation
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation/01-01-SUMMARY.md`:

# Phase 1 Plan 01: Project Structure & Types Summary

**[One-liner describing what was built]**

## Accomplishments
- [Key outcomes]

## Files Created/Modified
- `Cargo.toml` - Workspace configuration
- `src/lib.rs` - Library crate root
- `src/error.rs` - Error types
- `src/models/*.rs` - API response models
- `src/bin/immich-dupes.rs` - Binary entry point

## Decisions Made
[Any deviations from plan or choices made]

## Issues Encountered
[Problems and resolutions, or "None"]

## Next Step
Ready for 01-02-PLAN.md (HTTP Client & Authentication)
</output>
