---
phase: 02-duplicate-discovery
plan: 01
type: execute
---

<objective>
Complete the data model for duplicate discovery by adding missing API fields and metadata accessor methods.

Purpose: Ensure response types fully capture Immich API data and provide convenient methods for Phase 3 scoring.
Output: Updated `AssetResponse` and `ExifInfo` types with all relevant fields, plus helper methods for metadata completeness checks.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-duplicate-discovery/02-RESEARCH.md
@.planning/phases/01-foundation/01-02-SUMMARY.md

**Prior decisions affecting this phase:**
- Use `Option<T>` for all nullable API fields (Phase 1 pattern)
- Use `#[serde(rename_all = "camelCase")]` for JSON field mapping
- Use `#[serde(default)]` for fields that may be missing

**Research findings (02-RESEARCH.md):**
- GET /duplicates returns DuplicateResponseDto[] with embedded AssetResponseDto and ExifResponseDto
- All EXIF fields are nullable - graceful handling required
- No separate API calls needed - data comes embedded in duplicates response

**Current source files:**
@src/models/asset.rs
@src/models/exif.rs
@src/models/mod.rs
</context>

<tasks>

<task type="auto">
  <name>Task 1: Complete API response types</name>
  <files>src/models/asset.rs, src/models/exif.rs</files>
  <action>
Update AssetResponse in src/models/asset.rs to add missing fields from Immich API:
- `has_metadata: bool` (required field)
- `duration: String` (required - "0:00:00.000000" for images)
- `owner_id: String` (required)
- `original_mime_type: Option<String>` (optional)
- `duplicate_id: Option<String>` (optional - null if not a duplicate)
- `thumbhash: Option<String>` (required but nullable per API)

Update ExifInfo in src/models/exif.rs to add missing fields:
- `orientation: Option<String>` (image orientation)
- `modify_date: Option<String>` (file modification date)
- `projection_type: Option<String>` (for 360 photos)

Use `#[serde(default)]` on new optional fields to handle missing data gracefully.
Do NOT use `.unwrap()` anywhere - all fields should be Option or have serde defaults.
  </action>
  <verify>
cargo build --lib passes without errors
cargo clippy -- -D warnings passes without warnings
  </verify>
  <done>
AssetResponse has: has_metadata, duration, owner_id, original_mime_type, duplicate_id, thumbhash fields
ExifInfo has: orientation, modify_date, projection_type fields
All fields properly typed with Option where nullable
  </done>
</task>

<task type="auto">
  <name>Task 2: Add metadata accessor methods</name>
  <files>src/models/exif.rs, src/models/asset.rs</files>
  <action>
Add impl block to ExifInfo with helper methods for metadata completeness checks:

```rust
impl ExifInfo {
    /// Returns true if GPS coordinates are present
    pub fn has_gps(&self) -> bool {
        self.latitude.is_some() && self.longitude.is_some()
    }

    /// Returns true if camera make/model is present
    pub fn has_camera_info(&self) -> bool {
        self.make.is_some() || self.model.is_some()
    }

    /// Returns true if timezone information is present
    pub fn has_timezone(&self) -> bool {
        self.time_zone.is_some()
    }

    /// Returns true if original capture time is present
    pub fn has_capture_time(&self) -> bool {
        self.date_time_original.is_some()
    }

    /// Returns true if lens information is present
    pub fn has_lens_info(&self) -> bool {
        self.lens_model.is_some()
    }

    /// Returns true if location (city/country) is present
    pub fn has_location(&self) -> bool {
        self.city.is_some() || self.country.is_some()
    }
}
```

Add impl block to AssetResponse with convenience method:

```rust
impl AssetResponse {
    /// Returns true if this asset has any EXIF metadata
    pub fn has_exif(&self) -> bool {
        self.exif_info.is_some()
    }
}
```

These methods prepare for Phase 3 metadata scoring algorithm.
  </action>
  <verify>
cargo build --lib passes without errors
cargo clippy -- -D warnings passes without warnings
cargo test passes (if any tests exist)
  </verify>
  <done>
ExifInfo has methods: has_gps(), has_camera_info(), has_timezone(), has_capture_time(), has_lens_info(), has_location()
AssetResponse has method: has_exif()
All methods return bool and use safe Option handling
  </done>
</task>

</tasks>

<verification>
Before declaring phase complete:
- [ ] `cargo build --lib` succeeds without errors
- [ ] `cargo clippy -- -D warnings` passes with no warnings
- [ ] `cargo test` passes (if tests exist)
- [ ] `cargo doc --no-deps` generates documentation without warnings
- [ ] Types match Immich API spec (from 02-RESEARCH.md)
</verification>

<success_criteria>
- All tasks completed
- All verification checks pass
- No clippy warnings
- AssetResponse and ExifInfo types are complete per Immich API
- Helper methods provide clean interface for Phase 3 scoring
</success_criteria>

<output>
After completion, create `.planning/phases/02-duplicate-discovery/02-01-SUMMARY.md`:

# Phase 2 Plan 01: Duplicate Discovery Summary

**[Substantive one-liner - what shipped]**

## Performance

- **Duration:** X min
- **Started:** YYYY-MM-DDTHH:MM:SSZ
- **Completed:** YYYY-MM-DDTHH:MM:SSZ
- **Tasks:** 2
- **Files modified:** N

## Accomplishments

- [Key outcome 1]
- [Key outcome 2]

## Files Created/Modified

- `path/to/file.rs` - Description

## Decisions Made

[Key decisions and rationale, or "None"]

## Deviations from Plan

[Any changes from the plan, or "None"]

## Issues Encountered

[Problems and resolutions, or "None"]

## Next Phase Readiness

- Phase 2: Duplicate Discovery complete
- Ready for Phase 3: Metadata Scoring

---
*Phase: 02-duplicate-discovery*
*Completed: YYYY-MM-DD*
</output>
